<!--
	作者：642189953@qq.com
	时间：2015-09-16
	描述：导航页面
-->

<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<title>地图</title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/font-awesome.min.css" rel="stylesheet" />
		<style type="text/css">
			html {
				height: 100%;
			}
			body {
				height: 100%;
				margin: 0px;
				padding: 0px;
			}
			#dituContent {
				height: 63%;
			}
			.mui-btn-block {
				margin: 0 5% 0 5%;
				width: 90%;
			}
		</style>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=7IiPTajPLdYskQX77bPs6nhH"></script>
	</head>

	<body>
		<!--页头标题-->
		<header class="mui-bar mui-bar-nav">
			<a class="mui-icon mui-icon-info mui-pull-right" href="children/help.html"></a>
			<h1 class="mui-center mui-title">地图</h1>
		</header>
		<br />
		<br />



		<!--地图导航-->
		<div id="dituContent"></div>
		<div class="mui-content">
			<div class="mui-center">
				<a class="mui-btn mui-btn-negative mui-btn-block mui-btn-outlined" href="children/getLocation.html">
					<i class="fa fa-map-marker fa-lg"></i>&nbsp;我的位置
				</a>
			</div>
		</div>

		<script type="text/javascript">
			 //创建和初始化地图函数：
			function initMap() {
					createMap(); //创建地图
					setMapEvent(); //设置地图事件
					addMapControl(); //向地图添加控件
					addMarker(); //向地图中添加marker
				}
				//创建地图函数：

			function createMap() {
					var map = new BMap.Map("dituContent"); //在百度地图容器中创建一个地图
					var point = new BMap.Point(102.850008, 24.849534); //定义一个中心点坐标
					map.centerAndZoom(point, 15); //设定地图的中心点和坐标并将地图显示在地图容器中
					window.map = map; //将map变量存储在全局
				}
				//地图事件设置函数：

			function setMapEvent() {
					map.enableDragging(); //启用地图拖拽事件，默认启用(可不写)
					map.enableScrollWheelZoom(); //启用地图滚轮放大缩小
					map.enableDoubleClickZoom(); //启用鼠标双击放大，默认启用(可不写)
					map.enableKeyboard(); //启用键盘上下左右键移动地图
				}
				//地图控件添加函数：

			function addMapControl() {
					//向地图中添加缩放控件
					var ctrl_nav = new BMap.NavigationControl({
						anchor: BMAP_ANCHOR_TOP_LEFT,
						type: BMAP_NAVIGATION_CONTROL_ZOOM
					});
					map.addControl(ctrl_nav);
					//向地图中添加缩略图控件
					var ctrl_ove = new BMap.OverviewMapControl({
						anchor: BMAP_ANCHOR_BOTTOM_RIGHT,
						isOpen: 1
					});
					map.addControl(ctrl_ove);
					//向地图中添加比例尺控件
					var ctrl_sca = new BMap.ScaleControl({
						anchor: BMAP_ANCHOR_BOTTOM_LEFT
					});
					map.addControl(ctrl_sca);
				}
				//标注点数组
			var markerArr = [{
				title: "云南大学",
				content: "云南唯一“211”",
				point: "102.853134|24.835959",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "云南艺术学院",
				content: "我的备注",
				point: "102.83136|24.838844",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "云南民族大学",
				content: "我的备注",
				point: "102.858812|24.846189",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "昆明理工大学",
				content: "我的备注",
				point: "102.862836|24.860026",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "云南师范大学",
				content: "我的备注",
				point: "102.854284|24.865665",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "昆明医科大学",
				content: "我的备注",
				point: "102.838115|24.847894",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "云南中医学院",
				content: "我的备注",
				point: "102.828916|24.84455",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "云南广播电视大学",
				content: "我的备注",
				point: "102.836246|24.828154",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}, {
				title: "大学城地铁站",
				content: "中心位置",
				point: "102.848894|24.843238",
				isOpen: 0,
				icon: {
					w: 21,
					h: 21,
					l: 0,
					t: 0,
					x: 6,
					lb: 5
				}
			}];
			 //创建marker
			function addMarker() {
					for (var i = 0; i < markerArr.length; i++) {
						var json = markerArr[i];
						var p0 = json.point.split("|")[0];
						var p1 = json.point.split("|")[1];
						var point = new BMap.Point(p0, p1);
						var iconImg = createIcon(json.icon);
						var marker = new BMap.Marker(point, {
							icon: iconImg
						});
						var iw = createInfoWindow(i);
						var label = new BMap.Label(json.title, {
							"offset": new BMap.Size(json.icon.lb - json.icon.x + 10, -20)
						});
						marker.setLabel(label);
						map.addOverlay(marker);
						label.setStyle({
							borderColor: "#808080",
							color: "#333",
							cursor: "pointer"
						});
						(function() {
							var index = i;
							var _iw = createInfoWindow(i);
							var _marker = marker;
							_marker.addEventListener("click", function() {
								this.openInfoWindow(_iw);
							});
							_iw.addEventListener("open", function() {
								_marker.getLabel().hide();
							})
							_iw.addEventListener("close", function() {
								_marker.getLabel().show();
							})
							label.addEventListener("click", function() {
								_marker.openInfoWindow(_iw);
							})
							if (!!json.isOpen) {
								label.hide();
								_marker.openInfoWindow(_iw);
							}
						})()
					}
				}
				//创建InfoWindow

			function createInfoWindow(i) {
					var json = markerArr[i];
					var iw = new BMap.InfoWindow("<b class='iw_poi_title' title='" + json.title + "'>" + json.title + "</b><div class='iw_poi_content'>" + json.content + "</div>");
					return iw;
				}
				//创建一个Icon

			function createIcon(json) {
				var icon = new BMap.Icon("http://app.baidu.com/map/images/us_mk_icon.png", new BMap.Size(json.w, json.h), {
					imageOffset: new BMap.Size(-json.l, -json.t),
					infoWindowOffset: new BMap.Size(json.lb + 5, 1),
					offset: new BMap.Size(json.x, json.h)
				})
				return icon;
			}
			initMap(); //创建和初始化地图
		</script>
	</body>

</html>